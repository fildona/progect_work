<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Importa richieste finanziamento</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
    {% include 'navbar.html' %}
    <div class="container mt-5">
        <div class="card shadow-sm">
            <div class="card-header bg-primary text-white">
                <h2 class="mb-0 h5">Importa richieste di finanziamento</h2>
            </div>
            <div class="card-body">
                <p>
                    Verranno importate le richieste dal seguente link:<br>
                    <a href="https://testbobphp2.altervista.org/000AiForemaProjectWork/richieste_finanziamenti.php" target="_blank">
                        https://testbobphp2.altervista.org/000AiForemaProjectWork/richieste_finanziamenti.php
                    </a>
                </p>
                <button id="importaBtn" class="btn btn-success mb-3">Importa richieste</button>
                <div id="risultato"></div>
            </div>
        </div>
    </div>
    <script>
        document.getElementById('importaBtn').onclick = function() {
            const risultatoDiv = document.getElementById('risultato');
            risultatoDiv.innerHTML = '<div class="alert alert-info">Importazione in corso...</div>';
            fetch('/importa', {method: 'POST'})
                .then(res => res.json())
                .then(data => {
                    risultatoDiv.innerHTML = 
                        `<div class="alert alert-success">
                            Nuove richieste importate: <b>${data.importati}</b>
                        </div>`;
                })
                .catch(err => {
                    risultatoDiv.innerHTML = 
                        `<div class="alert alert-danger">Errore: ${err}</div>`;
                });
        }
    </script>
</body>
</html>